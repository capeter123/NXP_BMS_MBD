<!-- saved from url=(0014)about:internet -->
<pre class="code">
<span class="srcline"><span class="lineno"><a href="1,1" id="srcline1"> 1</a></span><span class="line"><span class="keyword">function</span> [<span class="var type1" id="S2T1U3">SPIDataStore</span>, <span class="var type1" id="S3T2U4">DataFault</span>] = fcn(<span class="var type1" id="S4T3U7">SPIData</span>, <span class="var type1" id="S5T4U8">PecChk</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="1,2" id="srcline2"> 2</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,3" id="srcline3"> 3</a></span><span class="line"><span class="keyword">global</span> <span class="var type0" id="S6T0U10">CellV_1_104</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,4" id="srcline4"> 4</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,5" id="srcline5"> 5</a></span><span class="line"><span class="var type0" id="S6T0U14"><span class="message error" id="M1F1C">CellV_1_104</span></span>(1) = <span class="mxinfo " id="T5:U5">1</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,6" id="srcline6"> 6</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,7" id="srcline7"> 7</a></span><span class="line"><span class="mxinfo " id="T1:U6"><span class="var type1" id="S2T1U19">SPIDataStore</span> = <span class="mxinfo " id="T1:U8">uint16(<span class="mxinfo " id="T5:U9">zeros(<span class="mxinfo " id="T5:U10">1</span>,<span class="mxinfo " id="T5:U11">21</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,8" id="srcline8"> 8</a></span><span class="line"><span class="mxinfo " id="T2:U12"><span class="var type1" id="S3T2U28">DataFault</span> =  <span class="mxinfo " id="T2:U14">zeros(<span class="mxinfo " id="T5:U15">1</span>,<span class="mxinfo " id="T5:U16">7</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,9" id="srcline9"> 9</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,10" id="srcline10">10</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S9T5U35">i</span>=<span class="mxinfo " id="T6:U18"><span class="mxinfo " id="T5:U19">1</span>:<span class="mxinfo " id="T5:U20">7</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,11" id="srcline11">11</a></span><span class="line">  <span class="mxinfo " id="T5:U21"><span class="mxinfo " id="T5:U22"><span class="var type1" id="S2T1U42">SPIDataStore</span>(<span class="mxinfo " id="T5:U24"><span class="mxinfo " id="T5:U25"><span class="var type1" id="S9T5U45">i</span>*<span class="mxinfo " id="T5:U27">3</span></span>-<span class="mxinfo " id="T5:U28">2</span></span>)</span> = <span class="mxinfo " id="T5:U29"><span class="mxinfo " id="T5:U30"><span class="var type1" id="S4T3U50">SPIData</span>(<span class="mxinfo " id="T5:U32"><span class="mxinfo " id="T5:U33"><span class="var type1" id="S9T5U53">i</span>*<span class="mxinfo " id="T5:U35">8</span></span>-<span class="mxinfo " id="T5:U36">7</span></span>)</span>+<span class="mxinfo " id="T5:U37"><span class="mxinfo " id="T5:U38"><span class="var type1" id="S4T3U58">SPIData</span>(<span class="mxinfo " id="T5:U40"><span class="mxinfo " id="T5:U41"><span class="var type1" id="S9T5U61">i</span>*<span class="mxinfo " id="T5:U43">8</span></span>-<span class="mxinfo " id="T5:U44">6</span></span>)</span>*<span class="mxinfo " id="T5:U45">256</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,12" id="srcline12">12</a></span><span class="line">  <span class="mxinfo " id="T5:U46"><span class="mxinfo " id="T5:U47"><span class="var type1" id="S2T1U68">SPIDataStore</span>(<span class="mxinfo " id="T5:U49"><span class="mxinfo " id="T5:U50"><span class="var type1" id="S9T5U71">i</span>*<span class="mxinfo " id="T5:U52">3</span></span>-<span class="mxinfo " id="T5:U53">1</span></span>)</span> = <span class="mxinfo " id="T5:U54"><span class="mxinfo " id="T5:U55"><span class="var type1" id="S4T3U76">SPIData</span>(<span class="mxinfo " id="T5:U57"><span class="mxinfo " id="T5:U58"><span class="var type1" id="S9T5U79">i</span>*<span class="mxinfo " id="T5:U60">8</span></span>-<span class="mxinfo " id="T5:U61">5</span></span>)</span>+<span class="mxinfo " id="T5:U62"><span class="mxinfo " id="T5:U63"><span class="var type1" id="S4T3U84">SPIData</span>(<span class="mxinfo " id="T5:U65"><span class="mxinfo " id="T5:U66"><span class="var type1" id="S9T5U87">i</span>*<span class="mxinfo " id="T5:U68">8</span></span>-<span class="mxinfo " id="T5:U69">4</span></span>)</span>*<span class="mxinfo " id="T5:U70">256</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,13" id="srcline13">13</a></span><span class="line">  <span class="mxinfo " id="T5:U71"><span class="mxinfo " id="T5:U72"><span class="var type1" id="S2T1U94">SPIDataStore</span>(<span class="mxinfo " id="T5:U74"><span class="var type1" id="S9T5U96">i</span>*<span class="mxinfo " id="T5:U76">3</span></span>   )</span> = <span class="mxinfo " id="T5:U77"><span class="mxinfo " id="T5:U78"><span class="var type1" id="S4T3U100">SPIData</span>(<span class="mxinfo " id="T5:U80"><span class="mxinfo " id="T5:U81"><span class="var type1" id="S9T5U103">i</span>*<span class="mxinfo " id="T5:U83">8</span></span>-<span class="mxinfo " id="T5:U84">3</span></span>)</span>+<span class="mxinfo " id="T5:U85"><span class="mxinfo " id="T5:U86"><span class="var type1" id="S4T3U108">SPIData</span>(<span class="mxinfo " id="T5:U88"><span class="mxinfo " id="T5:U89"><span class="var type1" id="S9T5U111">i</span>*<span class="mxinfo " id="T5:U91">8</span></span>-<span class="mxinfo " id="T5:U92">2</span></span>)</span>*<span class="mxinfo " id="T5:U93">256</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,14" id="srcline14">14</a></span><span class="line">  <span class="keyword">if</span> (<span class="mxinfo " id="T7:U94"><span class="mxinfo " id="T5:U95"><span class="var type1" id="S5T4U121">PecChk</span>(<span class="mxinfo " id="T5:U97"><span class="mxinfo " id="T5:U98"><span class="var type1" id="S9T5U124">i</span>*<span class="mxinfo " id="T5:U100">2</span></span>-<span class="mxinfo " id="T5:U101">1</span></span>)</span> == <span class="mxinfo " id="T5:U102"><span class="var type1" id="S4T3U128">SPIData</span>(<span class="mxinfo " id="T5:U104"><span class="mxinfo " id="T5:U105"><span class="var type1" id="S9T5U131">i</span>*<span class="mxinfo " id="T5:U107">8</span></span>-<span class="mxinfo " id="T5:U108">1</span></span>)</span></span>) &amp;&amp; (<span class="mxinfo " id="T7:U109"><span class="mxinfo " id="T5:U110"><span class="var type1" id="S5T4U137">PecChk</span>(<span class="mxinfo " id="T5:U112"><span class="var type1" id="S9T5U139">i</span>*<span class="mxinfo " id="T5:U114">2</span></span>)</span> == <span class="mxinfo " id="T5:U115"><span class="var type1" id="S4T3U142">SPIData</span>(<span class="mxinfo " id="T5:U117"><span class="var type1" id="S9T5U144">i</span>*<span class="mxinfo " id="T5:U119">8</span></span>)</span></span>)</span></span>
<span class="srcline"><span class="lineno"><a href="1,15" id="srcline15">15</a></span><span class="line">    <span class="mxinfo " id="T5:U120"><span class="mxinfo " id="T5:U121"><span class="var type1" id="S3T2U149">DataFault</span>(<span class="var type1" id="S9T5U150">i</span>)</span> = <span class="mxinfo " id="T5:U124">1</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,16" id="srcline16">16</a></span><span class="line">  <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,17" id="srcline17">17</a></span><span class="line">    <span class="mxinfo " id="T5:U125"><span class="mxinfo " id="T5:U126"><span class="var type1" id="S3T2U156">DataFault</span>(<span class="var type1" id="S9T5U157">i</span>)</span> = <span class="mxinfo " id="T5:U129">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,18" id="srcline18">18</a></span><span class="line">  <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,19" id="srcline19">19</a></span><span class="line"><span class="keyword"><span class="keyword">end</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,20" id="srcline20">20</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,21" id="srcline21">21</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,22" id="srcline22">22</a></span><span class="line"><span class="comment">% onemask8 = uint16(hex2dec('00FF'));</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,23" id="srcline23">23</a></span><span class="line"><span class="comment">% onemask8_8sft = uint16(hex2dec('FF00'));</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,24" id="srcline24">24</a></span><span class="line"><span class="comment">% onemask88 = uint8(hex2dec('FF'));</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,25" id="srcline25">25</a></span><span class="line"><span class="comment">% onemask16 = uint16(hex2dec('FFFF'));</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,26" id="srcline26">26</a></span><span class="line"><span class="comment">% </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,27" id="srcline27">27</a></span><span class="line"><span class="comment">% % data_test = zeros(1,2);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,28" id="srcline28">28</a></span><span class="line"><span class="comment">% remainder = uint16(16);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,29" id="srcline29">29</a></span><span class="line"><span class="comment">% </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,30" id="srcline30">30</a></span><span class="line"><span class="comment">% for i=1:len</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,31" id="srcline31">31</a></span><span class="line"><span class="comment">%     ii = uint16(i);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,32" id="srcline32">32</a></span><span class="line"><span class="comment">% %     data_test(1,i) = data(ii);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,33" id="srcline33">33</a></span><span class="line"><span class="comment">% %     address = 2;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,34" id="srcline34">34</a></span><span class="line"><span class="comment">%     address = bitand( <span class="keyword">...</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,35" id="srcline35">35</a></span><span class="line"><span class="comment">%         bitxor( <span class="keyword">...</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,36" id="srcline36">36</a></span><span class="line"><span class="comment">%         uint8(bitsra(remainder,7)),data(ii) ), <span class="keyword">...</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,37" id="srcline37">37</a></span><span class="line"><span class="comment">%         onemask88);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,38" id="srcline38">38</a></span><span class="line"><span class="comment">%     remainder = bitxor(bitshift(remainder,8,'uint16'),pec15Table(address+1));</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,39" id="srcline39">39</a></span><span class="line"><span class="comment">% end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,40" id="srcline40">40</a></span><span class="line"><span class="comment">% pec15 = uint16(bitand(bitshift(remainder,1,'uint16'),onemask16));</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,41" id="srcline41">41</a></span><span class="line"><span class="comment">% pec0 = uint8(bitand(pec15,onemask8));</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,42" id="srcline42">42</a></span><span class="line"><span class="comment">% pec1 = uint8(bitsra(bitand(pec15,onemask8_8sft),8));</span></span></span>
</pre>
